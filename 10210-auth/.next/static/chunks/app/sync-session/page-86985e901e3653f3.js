(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[589],{27016:(e,t,n)=>{"use strict";n.d(t,{PromisifiedAuthProvider:()=>l,d:()=>u});var r=n(51088),s=n(38572),a=n(35583),i=n(12115);let o=i.createContext(null);function l(e){let{authPromise:t,children:n}=e;return i.createElement(o.Provider,{value:t},n)}function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,a.useRouter)(),n=i.useContext(o),l=n;return(n&&"then"in n&&(l=i.use(n)),"undefined"!=typeof window)?(0,r.As)({...l,...e}):t?(0,r.As)(e):(0,s.hP)({...l,...e})}},35583:(e,t,n)=>{e.exports=n(63950)},36902:(e,t,n)=>{Promise.resolve().then(n.bind(n,73220))},38572:(e,t,n)=>{"use strict";n.d(t,{T5:()=>s.T5,hP:()=>r.hP,nO:()=>s.nO,yC:()=>a}),n(84089);var r=n(15359),s=n(7827);function a(e,t,n){let s=t.path||(null==n?void 0:n.path);return"path"===(t.routing||(null==n?void 0:n.routing)||"path")?s?{...n,...t,routing:"path"}:r.sb.throw((0,r.kd)(e)):t.path?r.sb.throw((0,r.s7)(e)):{...n,...t,path:void 0}}},63950:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useRouter",{enumerable:!0,get:function(){return a}});let r=n(12115),s=n(70901);function a(){return(0,r.useContext)(s.RouterContext)}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},70901:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouterContext",{enumerable:!0,get:function(){return r}});let r=n(88229)._(n(12115)).default.createContext(null)},73220:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n(95155),s=n(12115),a=n(51088),i=n(27016),o=n(35695);function l(){let{user:e,isLoaded:t}=(0,a.Jd)(),{getToken:n}=(0,i.d)(),l=(0,o.useRouter)(),[u,d]=(0,s.useState)("Syncing session...");return(0,s.useEffect)(()=>{(async()=>{if(t)if(e){var r,s;d("Found active Clerk session, updating cache...");let t=await n(),a={id:e.id,email:(null==(r=e.primaryEmailAddress)?void 0:r.emailAddress)||"",firstName:e.firstName||"",lastName:e.lastName||"",fullName:e.fullName||"",username:e.username||e.firstName||"User",imageUrl:e.imageUrl||"",phone:(null==(s=e.primaryPhoneNumber)?void 0:s.phoneNumber)||"",createdAt:e.createdAt,token:t,isLoggedIn:!0,lastUpdated:new Date().toISOString()};localStorage.setItem("cuwhapp_user_cache",JSON.stringify(a)),localStorage.setItem("whatsapp_agent_user",JSON.stringify(a));try{let e=await fetch("".concat("https://app.cuwapp.com","/api/users/sync"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({user_id:a.id,email:a.email,name:a.fullName,metadata:{firstName:a.firstName,lastName:a.lastName,username:a.username,phone:a.phone}})});if(e.ok){let t=await e.json();localStorage.setItem("user_subscription",JSON.stringify(t)),d("Session synced successfully! Redirecting...")}}catch(e){console.error("Failed to sync with backend:",e),d("Session cached locally. Redirecting...")}setTimeout(()=>{window.location.href="https://app.cuwapp.com"},1500)}else d("No active session found. Redirecting to sign-in..."),setTimeout(()=>{l.push("/sign-in")},1500)})()},[t,e,n,l]),(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 to-green-100",children:(0,r.jsxs)("div",{className:"text-center p-8 bg-white rounded-lg shadow-lg",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Session Sync"}),(0,r.jsx)("p",{className:"text-gray-600",children:u})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[542,441,684,358],()=>t(36902)),_N_E=e.O()}]);